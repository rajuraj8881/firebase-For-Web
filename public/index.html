<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>

<body>
  <h1>Firebase Upload File</h1>

  <input type="file" onchange="uploadFile()" id="files" multiple />

  <div id="result"></div>

  <script src="https://www.gstatic.com/firebasejs/8.8.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.8.0/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.8.0/firebase-storage.js"></script>
  <script>

    var firebaseConfig = {
      apiKey: "AIzaSyBAFI5pwgumF_KKpgZTDabG0Z3eUmBll4o",
      authDomain: "fir-hosting-b4ddb.firebaseapp.com",
      projectId: "fir-hosting-b4ddb",
      storageBucket: "fir-hosting-b4ddb.appspot.com",
      messagingSenderId: "726207258592",
      appId: "1:726207258592:web:cfcc1e034efff054799585",
      measurementId: "G-ECLSPSRGL1"
    };

    firebase.initializeApp(firebaseConfig);


    function uploadFile() {
      let file = document.getElementById('files').files[0]

      firebase.storage().ref('images').child(file.name).put(file).then(() => {
        alert("Image upload successfully");
        firebase.storage().ref('images').child(file.name).getDownloadURL().then(URL => {
          console.log(URL);
          getAllFile();
        })
      }).catch(err => console.log(err))
    }


    function deleteFile(name) {
      firebase.storage().ref('images').child(name).delete().then(() => {
        alert("File deleted.")
      }).catch(err => console.log(err))
    }


    function getAllFile() {
      firebase.storage().ref('images').listAll().then(filesRef => {
        // console.log(filesRef.items);
        filesRef.items.forEach(fileRef => {
          console.log(fileRef);
          getDownloadURLFromRef(fileRef);
        });
      }).catch(err => console.log(err))
    }

    function getDownloadURLFromRef(ref) {
      document.getElementById('result').innerHTML = ""
      ref.getDownloadURL().then(URL => {
        console.log(URL);
        document.getElementById('result').innerHTML += `
        <div style="background:gray; width=20%;">
          <image src="${URL}" width="20%" height="30%"/>
        </div>
        `
      })
    }
    //file delete delete methode 
    // <button onClick="deleteFileFromRef('${ref}')">Delete</button>
    // function deleteFileFromRef(ref) {
    //   console.log(ref);
    // ref.delete().then(() => {
    //   alert("Image deleted.");
    //   getAllFile();
    // }).catch(err => console.log(err));
    // }


    getAllFile();

    // deleteFile('1703010400316025.png');
  </script>
</body>

</html>